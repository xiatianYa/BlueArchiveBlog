<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.blue.sort.mapper.BlueSortMapper">

    <resultMap type="BlueSort" id="BlueSortResult">
        <result property="id" column="id"/>
        <result property="sortName" column="sort_name"/>
    </resultMap>

    <resultMap id="BlueSortBlueSortTagResult" type="BlueSort" extends="BlueSortResult">
        <collection property="blueSortTagList" notNullColumn="sub_id" javaType="java.util.List"
                    resultMap="BlueSortTagResult"/>
    </resultMap>

    <resultMap type="BlueSortTag" id="BlueSortTagResult">
        <result property="id" column="sub_id"/>
        <result property="sortId" column="sub_sort_id"/>
        <result property="tagName" column="sub_tag_name"/>
    </resultMap>

    <sql id="selectBlueSortVo">
        select id, sort_name
        from blue_sort
    </sql>

    <select id="selectBlueSortList" parameterType="BlueSort" resultMap="BlueSortResult">
        <include refid="selectBlueSortVo"/>
        <where>
            <if test="sortName != null  and sortName != ''">and sort_name like concat('%', #{sortName}, '%')</if>
        </where>
    </select>

    <select id="selectBlueSortById" parameterType="Long" resultMap="BlueSortBlueSortTagResult">
        select a.id,
               a.sort_name,
               b.id       as sub_id,
               b.sort_id  as sub_sort_id,
               b.tag_name as sub_tag_name
        from blue_sort a
                 left join blue_sort_tag b on b.sort_id = a.id
        where a.id = #{id}
    </select>

    <insert id="insertBlueSort" parameterType="BlueSort" useGeneratedKeys="true" keyProperty="id">
        insert into blue_sort
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="sortName != null and sortName != ''">sort_name,</if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="sortName != null and sortName != ''">#{sortName},</if>
        </trim>
    </insert>

    <update id="updateBlueSort" parameterType="BlueSort">
        update blue_sort
        <trim prefix="SET" suffixOverrides=",">
            <if test="sortName != null and sortName != ''">sort_name = #{sortName},</if>
        </trim>
        where id = #{id}
    </update>

    <delete id="deleteBlueSortById" parameterType="Long">
        delete
        from blue_sort
        where id = #{id}
    </delete>

    <delete id="deleteBlueSortByIds" parameterType="String">
        delete from blue_sort where id in
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <delete id="deleteBlueSortTagBySortIds" parameterType="String">
        delete from blue_sort_tag where sort_id in
        <foreach item="sortId" collection="array" open="(" separator="," close=")">
            #{sortId}
        </foreach>
    </delete>

    <delete id="deleteBlueSortTagBySortId" parameterType="Long">
        delete
        from blue_sort_tag
        where sort_id = #{sortId}
    </delete>

    <insert id="batchBlueSortTag">
        insert into blue_sort_tag( id, sort_id, tag_name) values
        <foreach item="item" index="index" collection="list" separator=",">
            ( #{item.id}, #{item.sortId}, #{item.tagName})
        </foreach>
    </insert>
</mapper>